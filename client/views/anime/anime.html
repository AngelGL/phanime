<template name="anime">

<div class="container main-content">
	{{#if currentUser}}
		{{> reviewAddModal}}
		{{> revisionAnimeEditModal}}
	{{/if}}

	<div class="row">
		<div class="col s12">
			<div class="block" style="margin-bottom: 0">
				<div class="row">
					<div class="hide-on-small-only col s12 m4 l2">
						<div style="background-image: url('{{coverImageUrl}}')" class="anime-cover"></div>
					</div>
					<div class="col s12 m8 l10">
						<h5 style="margin-top:0">
							{{title}}
						</h5>

						<ul class="anime-info">
							{{#if type}}<li>{{type}}</li>{{/if}}
							{{#if totalEpisodes}}<li>{{totalEpisodes}} episodes</li>{{/if}}
							{{#if episodeDuration}}<li>{{episodeDuration}} mins.</li>{{/if}}
							{{#if ageRating}}<li>{{ageRating}}</li>{{/if}}
							<li>{{airingText}} {{formatDateUTC startDate}} to {{#if isMomentDatePresent endDate}} {{formatDateUTC endDate}}{{else}} - {{/if}}</li>
						</ul>

						<div class="description thin-text">{{description}}</div>

					</div>
				</div>
			</div>
		</div>
	</div>

	<div class="row">
		<div class="col s8 m10">
			<div class="tagList">
				{{#if genres}}
					{{#each genres}}
						<a class="genre">{{this}}</a>
					{{/each}}
				{{/if}}

				{{#if themes}}
					{{#each themes}}
						<a class="theme">{{this}}</a>
					{{/each}}
				{{/if}}
			</div>
		</div>

		<div class="col s12 m2">
			<div class="right">
				{{#if currentUser}}
					<a class="btn waves-effect waves-light light-green modal-trigger" href="#revisionAnimeEditModal">
						Edit  <i class="mdi-content-create right"></i>
					</a>
				{{/if}}
			</div>
		</div>
	</div>

	<div class="row">
		<div class="col s12 m6 l4">
			<div class="block">
				<h5 class="thin-text">Rating Overview</h5>

				{{#if rating}}
					<div class="row">
						<div class="col-xs-4 col-lg-4">
							<h2 class="thin-text centered-text" style="margin-top: 35px">{{roundDecimal 2 rating}}</h2>
						</div>
						<div class="col-xs-8 col-lg-8">
							<div title="{{ratingCounts.[10]}}" class="rating-bar" style="width: {{getPercentage ratingCounts.[10] totalRatings}}"></div>
							<div title="{{ratingCounts.[9]}}" class="rating-bar" style="width: {{getPercentage ratingCounts.[9] totalRatings}}"></div>
							<div title="{{ratingCounts.[8]}}" class="rating-bar" style="width: {{getPercentage ratingCounts.[8] totalRatings}}"></div>
							<div title="{{ratingCounts.[7]}}" class="rating-bar" style="width: {{getPercentage ratingCounts.[7] totalRatings}}"></div>
							<div title="{{ratingCounts.[6]}}" class="rating-bar" style="width: {{getPercentage ratingCounts.[6] totalRatings}}"></div>
							<div title="{{ratingCounts.[5]}}" class="rating-bar" style="width: {{getPercentage ratingCounts.[5] totalRatings}}"></div>
							<div title="{{ratingCounts.[4]}}" class="rating-bar" style="width: {{getPercentage ratingCounts.[4] totalRatings}}"></div>
							<div title="{{ratingCounts.[3]}}" class="rating-bar" style="width: {{getPercentage ratingCounts.[3] totalRatings}}"></div>
							<div title="{{ratingCounts.[2]}}" class="rating-bar" style="width: {{getPercentage ratingCounts.[2] totalRatings}}"></div>
							<div title="{{ratingCounts.[1]}}" class="rating-bar" style="width: {{getPercentage ratingCounts.[1] totalRatings}}"></div>
						</div>
					</div>
				{{else}}
					<p class="thin-text">No rating available</p>
				{{/if}}
			</div>
		</div>

		<div class="col s12 m6 l4">
			<div class="block scroll-ready">
				<h5 class="thin-text">Casting</h5>

					<div class="blaze-wrapper">
					{{#each castings}}
						<div class="row" style="padding: 5px 0; border-bottom: 1px solid #EBEBEB;">
							<div class="col m6">
								{{#with character}}
								<a href="{{pathFor 'character'}}">{{fullName}}</a>: {{../role}}
								{{/with}}
							</div>

							<div class="col m6">
								{{#with person}}
								<a href="{{pathFor 'person'}}"> {{fullName}}</a>: {{../language}}
								{{/with}}
							</div>
						</div>
					{{else}}
						<p class="thin-text">No castings found</p>
					{{/each}}
					</div>

			</div>
		</div>

		<div class="col s12 m6 l4">
			<div class="block scroll-ready">
				<h5 class="thin-text">Staff Members</h5>
					<div class="blaze-wrapper">
					{{#each staffMembers}}
						<div class="row" style="padding: 5px 0; border-bottom: 1px solid #EBEBEB;">
							<div class="col m6">
								{{#with person}}
									<a href="{{pathFor 'person'}}">{{fullName}}</a>
								{{/with}}
							</div>

							<div class="col m6">
								{{staffPosition}}
							</div>
						</div>
					{{else}}
						<p class="thin-text">No staff members found</p>
					{{/each}}
					</div>

			</div>
		</div>
	</div>


	<div class="row">

		<div class="col s12 m5 l4">

			<div class="block">
				<div class="row">
					<h5 class="thin-text left">Reviews</h5>
					{{#if currentUser}}
						<a class="waves-effect waves-light btn modal-trigger right" href="#reviewAddModal">Write Review</a>
					{{/if}}
				</div>
			</div>
		
			{{#each reviews}}
				{{> UI.dynamic template="reviewCard" data=this}}
			{{/each}}
			
		</div>

		<div class="col s12 m7 l8">
			
			<div class="block scroll-ready">
				<h5 class="thin-text">Episodes</h5>

				<table class="bordered">
					<thead>
						<tr>
							<td>#</td>
							<td>Episode Title</td>
							<td>Air Date</td>
						</tr>
					</thead>

					<tbody>
						{{#each episodes}}
							<tr class="thin-text">
								<td>{{episodeNumber}}</td>
								<td>{{#if episodeTitle}} {{episodeTitle}} {{else}} -- {{/if}}</td>
								<td>{{#if isMomentDatePresent airDate}} {{formatDateUTC airDate}} {{else}} -- {{/if}}</td>
							</tr>
						{{/each}}
					</tbody>
				</table>
			
			</div>
			
		</div>


	</div>

</div>

{{#if currentUser}}
	{{> animeAddButton}}
{{/if}}

</template>